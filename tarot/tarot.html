<!DOCTYPE html>
<html>
    <head>
        <title>簡易塔羅抽牌</title>
    </head>
    <script>
        // card number and name mapping
        var card_name_dict={
            0:"愚者",
            1:"魔術師",
            2:"女教皇",
            3:"女帝",
            4:"皇帝",
            5:"教皇",
            6:"戀人",
            7:"戰車",
            8:"力量",
            9:"隱者",
            10:"命運之輪",
            11:"正義",
            12:"吊人",
            13:"死神",
            14:"節制",
            15:"惡魔",
            16:"高塔",
            17:"星星",
            18:"月亮",
            19:"太陽",
            20:"審判",
            21:"世界",
            22:"權杖1",
            23:"權杖2",
            24:"權杖3",
            25:"權杖4",
            26:"權杖5",
            27:"權杖6",
            28:"權杖7",
            29:"權杖8",
            30:"權杖9",
            31:"權杖10",
            32:"權杖侍者",
            33:"權杖騎士",
            34:"權杖皇后",
            35:"權杖國王",
            36:"聖杯1",
            37:"聖杯2",
            38:"聖杯3",
            39:"聖杯4",
            40:"聖杯5",
            41:"聖杯6",
            42:"聖杯7",
            43:"聖杯8",
            44:"聖杯9",
            45:"聖杯10",
            46:"聖杯侍者",
            47:"聖杯騎士",
            48:"聖杯皇后",
            49:"聖杯國王",
            50:"寶劍1",
            51:"寶劍2",
            52:"寶劍3",
            53:"寶劍4",
            54:"寶劍5",
            55:"寶劍6",
            56:"寶劍7",
            57:"寶劍8",
            58:"寶劍9",
            59:"寶劍10",
            60:"寶劍侍者",
            61:"寶劍騎士",
            62:"寶劍皇后",
            63:"寶劍國王",
            64:"錢幣1",
            65:"錢幣2",
            66:"錢幣3",
            67:"錢幣4",
            68:"錢幣5",
            69:"錢幣6",
            70:"錢幣7",
            71:"錢幣8",
            72:"錢幣9",
            73:"錢幣10",
            74:"錢幣侍者",
            75:"錢幣騎士",
            76:"錢幣皇后",
            77:"錢幣國王",
        }

        function initial_card_img_status(){
            for (var i=1; i<6; i++){
                document.getElementById("card_" + i).style = "display:none";
                document.getElementById("card_" + i).src = "card_img/back.jpg";

            }
        }

        // Initial when choose card spread
        function choose_card_spread(){
            // Set all cards to no display and to back-side
            initial_card_img_status()

            // Get spread and mapping to need how many cards
            var card_spread = document.getElementById("card").value;
            var spread_need_cards = {
                "3_card_spread": 3,
                "1_card_spread": 1,
                "1_card_spread_major_arcana": 1,
                "choose_card_spread": 5,
            }

            // Display card back-side with need cards
            for (var i=1; i<spread_need_cards[card_spread]+1; i++){
                document.getElementById("card_" + i).style = "";
            }

            // Clear last time card name list
            document.getElementById("card_list").style = "display:none";


            if (card_spread == "3_card_spread"){
                document.getElementById("card_spread_description").innerHTML="<h3>時間之流</h3>牌陣順序：[1][2][3]<br>第一張：過去<br>第二張：現在<br>第三張：未來";
            }
            if(card_spread == "1_card_spread"){
                document.getElementById("card_spread_description").innerHTML="<h3>單張牌</h3>";
            }
            if(card_spread == "choose_card_spread"){
                document.getElementById("card_spread_description").innerHTML="[4] [5]<br>[2][3]<br>[1]";
            }
        }

        // Get cards when submit
        function get_random_card() {

            var all_card = 78;

            if (document.getElementById("cbox1").checked){
                all_card = 22;
            }

            // Get spread and mapping to need how many cards
            var card_spread = document.getElementById("card").value;
            var spread_need_cards = {
                "3_card_spread": 3,
                "1_card_spread": 1,
                "choose_card_spread": 5,
            };

            // Set card list
            var card_list = [];
            var used_card = [];

            // Counting have how many card now
            var card_count = 0;

            // If now cards less than need cards
            while (card_count < spread_need_cards[card_spread]) {
                // Initial random card value
                var random_card = 0;

                // Get card from all 78 cards
                var random_card = Math.floor(Math.random() * (all_card * 2) ) - all_card;

                // // Make reversed card
                // var is_reversed = Math.floor(Math.random() * 2);

                // If do not have this card before
                if (used_card.includes(random_card) === false){
                    // Record used card
                    used_card.push(random_card);
                    used_card.push(random_card - (random_card * 2));

                    card_list.push(random_card);

                    card_count ++;
                }
            }

            // document.getElementById("card_debug").innerHTML = "card: " +card_list;

            var card_name_list = "";

            for (var i=1; i<spread_need_cards[card_spread]+1; i++){
                // Normal card display
                if (card_list[i-1] >= 0){
                    card_name_list = card_name_list + " " + card_name_dict[card_list[i-1]];
                    document.getElementById("card_" + i).src="card_img/c" + card_list[i-1] + ".jpg";
                    document.getElementById("card_" + i).style="";
                }
                // Reversed card display
                else{
                    card_name_list = card_name_list + " " + card_name_dict[Math.abs(card_list[i-1])] + "(逆位)";
                    document.getElementById("card_" + i).src="card_img/c" + Math.abs(card_list[i-1]) + ".jpg";
                    document.getElementById("card_" + i).style="transform:rotate(180deg);";
                }
            }

            document.getElementById("card_list").style = "";
            document.getElementById("card_list").innerHTML = card_name_list;
        }

    </script>
    <body>

        <h1>簡易塔羅抽牌</h1>
        <label>請選擇牌陣：</label>
        <select id="card" onchange="choose_card_spread();">
            <option>--牌陣--</option>
            <option value="3_card_spread">時間之流</option>
            <option value="1_card_spread">單張牌</option>
            <option value="choose_card_spread">二擇一</option>
        </select>

        <input type="checkbox" id="cbox1" value="only_major_arcana">
        <label for="cbox1">僅使用大阿爾克那</label>

        <input type="submit" value="抽牌" onclick="get_random_card();">
        <br>
        <img id="card_1" src="card_img/back.jpg" width="100px" style="display:none"></img>
        <img id="card_2" src="card_img/back.jpg" width="100px" style="display:none"></img>
        <img id="card_3" src="card_img/back.jpg" width="100px" style="display:none"></img>
        <img id="card_4" src="card_img/back.jpg" width="100px" style="display:none"></img>
        <img id="card_5" src="card_img/back.jpg" width="100px" style="display:none"></img>
        <p id="card_list" style="display:none"></p>
        <!-- <p id="card_debug"></p> -->
        <br>
        牌陣說明：
        <p id="card_spread_description"></p>

</body>
</html>